<!DOCTYPE html>
<html lang="kor">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sort</title>

    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

    <link href="./assets/css/ia.css" type="text/css" media="all" rel="stylesheet" />
    <!-- 덜 중요한 리소스 로드(ex 접근성) -->
    <!-- <script type="module" async src="./assets/js/sort.js"></script> -->
  </head>
  <body>
    <!-- wrap -->
    <div id="wrap">

      <p>정렬하기 <button onclick="sortLI()">▲</button> <button onclick="reverseLI()">▼</button></p>

      <ul id="lists">
        <li class="li">064-1234-5678</li>
        <li class="li">063-1234-5678</li>
        <li class="li">061-1234-5678</li>
        <li class="li">055-1234-5678</li>
        <li class="li">054-1234-5678</li>
        <li class="li">044-1234-5678</li>
        <li class="li">043-1234-5678</li>
        <li class="li">041-1234-5678</li>
        <li class="li">033-1234-5678</li>
        <li class="li">032-1234-5678</li>
        <li class="li">031-1234-5678</li>
        <li class="li">02-1234-5678</li>
      </ul>

      <!-- <table class="table" id="lists">
        <tbody>
          <tr><td> 아바타 </td></tr>
          <tr><td> 어벤져스 : 에이지 오브 울트론 </td></tr>
          <tr><td> 인터스텔라 </td></tr>
          <tr><td> 트랜스포머 </td></tr>
          <tr><td> 겨울왕국 </td></tr>
        </tbody>
      </table> -->

    </div>
    <!-- //wrap -->
    
    <style>
      #wrap {
        padding: 20px;
        font-size: 12px;
      }
      ul {
        width: 200px;
        margin-top: 20px;
      }
      li {
        padding: 5px;
        border: 1px solid #7a7a7a;
        margin-top: -1px;
      }
    </style>

    <script>
      function sortingNumber(a, b) {
        if (typeof a == "number" && typeof b == "number") return a - b;

        // 천단위 쉼표와 공백문자만 삭제하기.
        var a = (a + "").replace(/[,\s\xA0]+/g, "");
        var b = (b + "").replace(/[,\s\xA0]+/g, "");

        var numA = parseFloat(a) + "";
        var numB = parseFloat(b) + "";

        if (numA == "NaN" || numB == "NaN" || a != numA || b != numB) return false;

        return parseFloat(a) - parseFloat(b);
      }

      /* changeForSorting() : 문자열 바꾸기. */

      function changeForSorting(first, second) {
        // 문자열의 복사본 만들기.
        var a = first.toString().replace(/[\s\xA0]+/g, " ");
        var b = second.toString().replace(/[\s\xA0]+/g, " ");

        var change = { first: a, second: b };

        if (a.search(/\d/) < 0 || b.search(/\d/) < 0 || a.length == 0 || b.length == 0) return change;

        var regExp = /(\d),(\d)/g; // 천단위 쉼표를 찾기 위한 정규식.

        a = a.replace(regExp, "$1" + "$2");
        b = b.replace(regExp, "$1" + "$2");

        var unit = 0;
        var aNb = a + " " + b;
        var numbers = aNb.match(/\d+/g); // 문자열에 들어있는 숫자 찾기

        for (var x = 0; x < numbers.length; x++) {
          var length = numbers[x].length;
          if (unit < length) unit = length;
        }

        var addZero = function (string) {
          // 숫자들의 단위 맞추기

          var match = string.match(/^0+/);

          if (string.length == unit) return match == null ? string : match + string;

          var zero = "0";

          for (var x = string.length; x < unit; x++) string = zero + string;

          return match == null ? string : match + string;
        };

        change.first = a.replace(/\d+/g, addZero);
        change.second = b.replace(/\d+/g, addZero);

        return change;
      }

      /* byLocale() */

      function byLocale() {
        var compare = function (a, b) {
          var sorting = sortingNumber(a, b);

          if (typeof sorting == "number") return sorting;

          var change = changeForSorting(a, b);

          var a = change.first;
          var b = change.second;

          return a.localeCompare(b);
        };

        var ascendingOrder = function (a, b) {
          return compare(a, b);
        };
        var descendingOrder = function (a, b) {
          return compare(b, a);
        };

        return { ascending: ascendingOrder, descending: descendingOrder };
      }

      /* replacement() */

      function replacement(parent) {

        // 오브젝트 속성 확인
        let obj = new Object(parent)
        let msg = '';
        for(let temp in obj){
          msg += temp + ' = ' + obj[temp] + '\n';
        }
        // console.log(msg);
        // 오브젝트 속성 확인

        // 태그 네임 소문자로 변환
        let tagName = parent.tagName.toLowerCase();
        // children 변수 생성
        let children;

        // 테이블일때
        if (tagName == "table") {
          // 선택 요소에 첫번째 tbody 대입 
          parent = parent.tBodies[0];
          // children 에 tr 대입
          // console.log(parent.rows);
          children = parent.rows;

        // 그밖에 ul 일때 
        } else {
          // children = parent.getElementsByTagName("li");
          // children = parent.getElementsByClassName("li");
          children = parent.querySelectorAll("li");
        }
        
        console.log(parent);
        console.log(tagName);
        console.log(children);
        

        // replace 오브젝트 생성
        let replace = {
          order: byLocale(),
          index: false,
          // array
          array: (function () {
            let array = [];
            for (let x = 0; x < children.length; x++) {
              array[x] = children[x];
              console.log(array);
            }
            return array;
          })(),
          checkIndex: function (index) {
            if (index) this.index = parseInt(index, 10);
            var tagName = parent.tagName.toLowerCase();
            if (tagName == "tbody" && !index) this.index = 0;
          },
          getText: function (child) {
            if (this.index) child = child.cells[this.index];
            return getTextByClone(child);
          },
          setChildren: function () {
            var array = this.array;
            while (parent.hasChildNodes()) parent.removeChild(parent.firstChild);
            for (var x = 0; x < array.length; x++) parent.appendChild(array[x]);
          },
          ascending: function (index) {
            // 오름차순
            this.checkIndex(index);
            var _self = this;
            var order = this.order;
            var ascending = function (a, b) {
              var a = _self.getText(a);
              var b = _self.getText(b);
              return order.ascending(a, b);
            };
            this.array.sort(ascending);
            this.setChildren();
          },
          descending: function (index) {
            // 내림차순
            this.checkIndex(index);
            var _self = this;
            var order = this.order;
            var descending = function (a, b) {
              var a = _self.getText(a);
              var b = _self.getText(b);
              return order.descending(a, b);
            };
            this.array.sort(descending);
            this.setChildren();
          },
        };

        console.log(replace);

        // replace 반환
        return replace;
      }

      function getTextByClone(tag) {
        var clone = tag.cloneNode(true); // 태그의 복사본 만들기.
        var br = clone.getElementsByTagName("br");
        while (br[0]) {
          var blank = document.createTextNode(" ");
          clone.insertBefore(blank, br[0]);
          clone.removeChild(br[0]);
        }
        var isBlock = function (tag) {
          var display = "";
          if (window.getComputedStyle) display = window.getComputedStyle(tag, "")["display"];
          else display = tag.currentStyle["display"];
          return display == "block" ? true : false;
        };
        var children = clone.getElementsByTagName("*");
        for (var x = 0; x < children.length; x++) {
          var child = children[x];
          if (!("value" in child) && isBlock(child)) child.innerHTML = child.innerHTML + " ";
        }
        var textContent = "textContent" in clone ? clone.textContent : clone.innerText;
        return textContent;
      }

      // 실행
      var myUL = document.getElementById("lists");
      var rep = replacement(myUL);
      function sortLI() {
        rep.ascending();
      }
      function reverseLI() {
        rep.descending();
      }

      function makeAdder(x) {
        var y = 1;
        return function(z) {
          y = 100;
          return x + y + z;
        };
      }
      var add5 = makeAdder(5);
      console.log(add5(2)); 
    </script>
  </body>
</html>
